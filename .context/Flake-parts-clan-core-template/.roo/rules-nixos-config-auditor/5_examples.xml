<![CDATA[
<examples>
  <example name="complete-flake-audit">
    <description>Complete audit of a NixOS clan-core configuration</description>
    <context>When reviewing a new or existing NixOS setup with clan-core</context>
    <code language="nix">
# Initial analysis command sequence
list_files: path: . recursive: true
read_file: args: [flake.nix, clan.nix, machines/luffy/default.nix]
search_files: path: . regex: "clan\.core\.networking" file_pattern: *.nix

# Expected findings and fixes
# 1. Fix flake inputs
inputs.clan-core.inputs.nixpkgs.follows = "nixpkgs";

# 2. Add missing luffy machine to clan
inventory.machines.luffy = {
  clan.core.networking.targetHost = "root@192.168.8.212";
};

# 3. Add omarchy-nix integration
inputs.omarchy-nix = {
  url = "github:henrysipp/omarchy-nix";
  inputs.nixpkgs.follows = "nixpkgs";
  inputs.home-manager.follows = "home-manager";
};
    </code>
    <explanation>
      This example shows the complete workflow for auditing a NixOS configuration,
      including identifying issues like missing machine definitions, incorrect flake inputs,
      and opportunities for enhancement with modern tools like omarchy-nix.
    </explanation>
  </example>

  <example name="secrets-management-setup">
    <description>Set up proper secrets management with sops-nix</description>
    <context>When adding or fixing secrets management in existing configurations</context>
    <code language="nix">
# 1. Add sops-nix input to flake.nix
inputs.sops-nix = {
  url = "github:Mic92/sops-nix";
  inputs.nixpkgs.follows = "nixpkgs";
};

# 2. Create .sops.yaml configuration
keys:
  - &admin_user age1recipientkey...

creation_rules:
  - path_regex: secrets/[^/]+\.(yaml|json)$
    key_groups:
      - age:
        - *admin_user

# 3. Add sops configuration to machine
sops = {
  age = "age1recipientkey...";
  defaultSopsFile = ./secrets/secrets.yaml;
};

# 4. Use secrets in services
services.postgresql.initialScript = sops.secrets."postgres-init.sql";
    </code>
    <explanation>
      This example demonstrates proper secrets management setup, including
      age key configuration, sops-nix integration, and usage in services.
      Always encrypt secrets and never commit plaintext credentials.
    </explanation>
  </example>

  <example name="omarchy-integration">
    <description>Integrate omarchy-nix for enhanced user experience</description>
    <context>When modernizing user environment management</context>
    <code language="nix">
# 1. Add omarchy-nix to flake inputs
inputs.omarchy-nix = {
  url = "github:henrysipp/omarchy-nix";
  inputs.nixpkgs.follows = "nixpkgs";
  inputs.home-manager.follows = "home-manager";
};

# 2. Import omarchy modules
imports = [
  inputs.omarchy-nix.nixosModules.default
  inputs.home-manager.nixosModules.home-manager
];

# 3. Configure omarchy
omarchy = {
  enable = true;
  full_name = "Erik Wright";
  email_address = "wrighterik77@gmail.com";
  theme = "tokyo-night";
  primary_font = "Berkeley Mono";
  quick_app_bindings = [
    "SUPER, A, exec, $webapp=https://claude.ai"
    "SUPER, E, exec, $webapp=https://app.hey.com"
  ];
};

# 4. User configuration with omarchy
home-manager.users.t0psh31f = {
  imports = [ inputs.omarchy-nix.homeManagerModules.default ];
  
  programs.home-manager.enable = true;
  programs.git.extraConfig.credential.helper = "store";
};
    </code>
    <explanation>
      This example shows comprehensive omarchy-nix integration, including
      flake inputs, module imports, configuration options, and user environment setup.
      Omarchy provides enhanced application bindings and user experience customization.
    </explanation>
  </example>

  <example name="troubleshooting-conflicts">
    <description>Resolve common configuration conflicts</description>
    <context>When encountering build failures or deployment issues</context>
    <code language="bash">
# 1. Check flake structure
nix flake check

# 2. Validate clan configuration
clan machines list

# 3. Test configuration build
nixos-rebuild build --flake .#luffy

# 4. Check for module conflicts
nix eval .#nixosConfigurations.luffy.config._module.args

# Common fixes:
# - Missing follows in inputs
# - Duplicate home-manager instances
# - Incorrect LUKS device UUIDs
# - Missing machine definitions in clan inventory
    </code>
    <explanation>
      This example provides troubleshooting steps for common issues,
      including validation commands and typical resolution approaches.
      Always test configurations before deployment.
    </explanation>
  </example>
</examples>
]]>